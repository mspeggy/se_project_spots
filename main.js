!function(){"use strict";const e={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit-btn",inactiveButtonClass:"modal__submit-btn_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error_visible"};function t(e,t,r){t.forEach(t=>{const n=e.querySelector(`#${t.id}-error`);n&&(t.classList.remove(r.inputErrorClass),n.textContent="",n.classList.remove(r.errorClass))});const n=e.querySelector(r.submitButtonSelector);n&&(n.disabled=!0,n.classList.add(r.inactiveButtonClass))}const r=(e,t,r)=>{(e=>e.some(e=>!e.validity.valid))(e)?((e,t)=>{e.disabled=!0,e.classList.add(t.inactiveButtonClass)})(t,r):((e,t)=>{e.disabled=!1,e.classList.remove(t.inactiveButtonClass)})(t,r)};function n(e,t,r="Save",n="Saving..."){e&&(t?(e.dataset.originalText||(e.dataset.originalText=e.textContent),e.textContent=n):(e.textContent=e.dataset.originalText||r,e.disabled=!1))}const o=new class{constructor({baseUrl:e,headers:t}){this._baseUrl=e,this._headers=t}_checkResponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}getAppInfo(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then(this._checkResponse)}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then(this._checkResponse)}addCard({name:e,link:t}){return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then(this._handleResponse)}editUserInfo({name:e,about:t}){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then(this._checkResponse)}updateAvatar(e){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then(this._checkResponse)}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)})}likeStatus(e,t){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:t?"DELETE":"PUT",headers:this._headers}).then(e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)})}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"f14e21ea-8f06-4616-983e-92c4689bb859","Content-Type":"application/json"}}),a=document.querySelector(".profile__edit-btn"),s=document.querySelector(".profile__add-btn"),l=document.querySelector(".profile__name"),c=document.querySelector(".profile__description"),i=document.querySelector(".profile__avatar"),d=document.querySelector(".profile__avatar-btn"),u=document.querySelector("#edit-modal"),m=document.querySelector("#add-card-modal"),_=document.querySelector("#avatar-modal"),h=document.querySelector("#preview-modal"),v=document.querySelector("#delete-modal"),y=u.querySelector(".modal__form"),S=m.querySelector(".modal__form"),p=_.querySelector("#edit-avatar-form"),f=v.querySelector("#delete-form"),b=u.querySelector("#profile-name-input"),q=u.querySelector("#profile-description-input"),k=m.querySelector("#add-card-name-input"),E=m.querySelector("#add-card-link-input"),L=_.querySelector("#profile-avatar-input"),C=u.querySelector(".modal__close-btn"),g=m.querySelector(".modal__close-btn"),x=_.querySelector(".modal__close-btn"),U=h.querySelector(".modal__close-btn"),$=v.querySelector(".modal__close-btn"),A=(f.querySelector('button[type="submit"]'),f.querySelector('button[type="button"]')),T=h.querySelector(".modal__image"),I=h.querySelector(".modal__caption"),P=document.querySelector("#card-template"),j=document.querySelector(".cards__list");let B=null,D=null;function R(e){e.classList.add("modal_opened"),document.addEventListener("keydown",N)}function w(e){e.classList.remove("modal_opened"),document.removeEventListener("keydown",N)}function N(e){if("Escape"===e.key){const e=document.querySelector(".modal_opened");e&&w(e)}}function O(e){const t=P.content.querySelector(".card").cloneNode(!0),r=t.querySelector(".card__image"),n=t.querySelector(".card__title"),a=t.querySelector(".card__like-btn"),s=t.querySelector(".card__delete-btn");return r.src=e.link,r.alt=e.name,n.textContent=e.name,e.isLiked&&a.classList.add("card__like-btn_liked"),a.addEventListener("click",()=>{const t=a.classList.contains("card__like-btn_liked");o.likeStatus(e._id,t).then(()=>{a.classList.toggle("card__like-btn_liked")}).catch(e=>{console.error("Failed to toggle like:",e)})}),r.addEventListener("click",()=>{T.src=e.link,T.alt=e.name,I.textContent=e.name,R(h)}),s.addEventListener("click",()=>{B=t,D=e._id,R(v)}),t}document.querySelectorAll(".modal").forEach(e=>{e.addEventListener("mousedown",t=>{t.target===e&&w(e)})});let J=null;var H;o.getAppInfo().then(([e,t])=>{J=t._id,i.src=t.avatar,i.alt=t.name,l.textContent=t.name,c.textContent=t.about,e.forEach(e=>{const t=O(e);j.append(t)})}).catch(console.error),a.addEventListener("click",()=>{b.value=l.textContent,q.value=c.textContent,t(u,[b,q],e),R(u)}),y.addEventListener("submit",e=>{e.preventDefault();const t=e.submitter;n(t,!0),o.editUserInfo({name:b.value,about:q.value}).then(e=>{l.textContent=e.name,c.textContent=e.about,w(u)}).catch(console.error).finally(()=>{n(t,!1,"Save")})}),s.addEventListener("click",()=>{t(m,[k,E],e),S.reset(),R(m)}),S.addEventListener("submit",e=>{e.preventDefault();const t=e.submitter;n(t,!0),o.addCard({name:k.value,link:E.value}).then(e=>{const t=O(e);j.prepend(t),S.reset(),w(m)}).catch(console.error).finally(()=>{n(t,!1,"Save")})}),d.addEventListener("click",()=>{t(_,[L],e),p.reset(),R(_)}),p.addEventListener("submit",e=>{e.preventDefault();const t=e.submitter;n(t,!0),o.updateAvatar(L.value).then(e=>{i.src=e.avatar,w(_),p.reset()}).catch(console.error).finally(()=>{n(t,!1,"Save")})}),U.addEventListener("click",()=>w(h)),f.addEventListener("submit",e=>{e.preventDefault();const t=e.submitter;n(t,!0,"Yes","Deleting..."),D&&B&&o.deleteCard(D).then(()=>{B.remove(),w(v),D=null,B=null}).catch(console.error).finally(()=>{n(t,!1,"Yes")})}),A.addEventListener("click",()=>{w(v),B=null,D=null}),$.addEventListener("click",()=>{w(v),B=null,D=null}),C.addEventListener("click",()=>w(u)),g.addEventListener("click",()=>w(m)),x.addEventListener("click",()=>w(_)),H=e,Array.from(document.querySelectorAll(H.formSelector)).forEach(e=>{((e,t)=>{const n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);o&&(r(n,o,t),n.forEach(a=>{a.addEventListener("input",()=>{((e,t,r)=>{t.validity.valid?((e,t,r)=>{const n=e.querySelector(`#${t.id}-error`);n.textContent="",t.classList.remove(r.inputErrorClass),n.classList.remove(r.errorClass)})(e,t,r):((e,t,r,n)=>{const o=e.querySelector(`#${t.id}-error`);o.textContent=r,t.classList.add(n.inputErrorClass),o.classList.add(n.errorClass)})(e,t,t.validationMessage,r)})(e,a,t),r(n,o,t)})}))})(e,H)})}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsIm1hcHBpbmdzIjoieUJBQ08sTUFBTUEsRUFBbUIsQ0FDOUJDLGFBQWMsZUFDZEMsY0FBZSxnQkFDZkMscUJBQXNCLHFCQUN0QkMsb0JBQXFCLDZCQUNyQkMsZ0JBQWlCLDBCQUNqQkMsV0FBWSx3QkFJUCxTQUFTQyxFQUFnQkMsRUFBY0MsRUFBZUMsR0FDM0RELEVBQWNFLFFBQVNDLElBQ3JCLE1BQU1DLEVBQWVMLEVBQWFNLGNBQWMsSUFBSUYsRUFBTUcsWUFDdERGLElBQ0ZELEVBQU1JLFVBQVVDLE9BQU9QLEVBQU9MLGlCQUM5QlEsRUFBYUssWUFBYyxHQUMzQkwsRUFBYUcsVUFBVUMsT0FBT1AsRUFBT0osZUFJekMsTUFBTWEsRUFBZVgsRUFBYU0sY0FBY0osRUFBT1Asc0JBQ25EZ0IsSUFDRkEsRUFBYUMsVUFBVyxFQUN4QkQsRUFBYUgsVUFBVUssSUFBSVgsRUFBT04scUJBRXRDLENBR0EsTUEyQ01rQixFQUFvQkEsQ0FBQ0MsRUFBV0MsRUFBZWQsS0FqQjVCYSxJQUNoQkEsRUFBVUUsS0FBTWIsSUFBV0EsRUFBTWMsU0FBU0MsT0FpQjdDQyxDQUFnQkwsR0FQQU0sRUFBQ0wsRUFBZWQsS0FDcENjLEVBQWNKLFVBQVcsRUFDekJJLEVBQWNSLFVBQVVLLElBQUlYLEVBQU9OLHNCQU1qQ3lCLENBQWNMLEVBQWVkLEdBZFpvQixFQUFDTixFQUFlZCxLQUNuQ2MsRUFBY0osVUFBVyxFQUN6QkksRUFBY1IsVUFBVUMsT0FBT1AsRUFBT04sc0JBY3BDMEIsQ0FBYU4sRUFBZWQsSUM1RXpCLFNBQVNxQixFQUFjQyxFQUFLQyxFQUFXQyxFQUFjLE9BQVFDLEVBQWMsYUFDekVILElBRURDLEdBQ01ELEVBQUlJLFFBQVFDLGVBQ3BCTCxFQUFJSSxRQUFRQyxhQUFlTCxFQUFJZCxhQUc3QmMsRUFBSWQsWUFBY2lCLElBR2xCSCxFQUFJZCxZQUFjYyxFQUFJSSxRQUFRQyxjQUFnQkgsRUFDbERGLEVBQUlaLFVBQVcsR0FFbkIsQ0NKQSxNQUFNa0IsRUFBTSxJQ1ZaLE1BQ0VDLFdBQUFBLEVBQVksUUFBRUMsRUFBTyxRQUFFQyxJQUNyQkMsS0FBS0MsU0FBV0gsRUFDaEJFLEtBQUtFLFNBQVdILENBQ2xCLENBR0FJLGNBQUFBLENBQWVDLEdBQ2IsT0FBSUEsRUFBSUMsR0FDQ0QsRUFBSUUsT0FFTkMsUUFBUUMsT0FBTyxVQUFVSixFQUFJSyxTQUN0QyxDQUdBQyxVQUFBQSxHQUVFLE9BQU9ILFFBQVFJLElBQUksQ0FBQ1gsS0FBS1ksa0JBQW1CWixLQUFLYSxlQUNuRCxDQUdBRCxlQUFBQSxHQUNFLE9BQU9FLE1BQU0sR0FBR2QsS0FBS0MsaUJBQWtCLENBQ3JDRixRQUFTQyxLQUFLRSxXQUNiYSxLQUFLZixLQUFLRyxlQUNmLENBR0FVLFdBQUFBLEdBQ0UsT0FBT0MsTUFBTSxHQUFHZCxLQUFLQyxvQkFBcUIsQ0FDeENGLFFBQVNDLEtBQUtFLFdBQ2JhLEtBQUtmLEtBQUtHLGVBQ2YsQ0FHRmEsT0FBQUEsRUFBUSxLQUFFQyxFQUFJLEtBQUVDLElBQ2QsT0FBT0osTUFBTSxHQUFHZCxLQUFLQyxpQkFBa0IsQ0FDckNrQixPQUFRLE9BQ1JwQixRQUFTQyxLQUFLRSxTQUNka0IsS0FBTUMsS0FBS0MsVUFBVSxDQUFFTCxPQUFNQyxXQUM1QkgsS0FBS2YsS0FBS3VCLGdCQUNmLENBR0VDLFlBQUFBLEVBQWEsS0FBRVAsRUFBSSxNQUFFUSxJQUNuQixPQUFPWCxNQUFNLEdBQUdkLEtBQUtDLG9CQUFxQixDQUN4Q2tCLE9BQVEsUUFDUnBCLFFBQVNDLEtBQUtFLFNBQ2RrQixLQUFNQyxLQUFLQyxVQUFVLENBQUVMLE9BQU1RLFlBQzVCVixLQUFLZixLQUFLRyxlQUNmLENBR0F1QixZQUFBQSxDQUFhQyxHQUNYLE9BQU9iLE1BQU0sR0FBR2QsS0FBS0MsMkJBQTRCLENBQy9Da0IsT0FBUSxRQUNScEIsUUFBU0MsS0FBS0UsU0FDZGtCLEtBQU1DLEtBQUtDLFVBQVUsQ0FBRU0sT0FBUUQsTUFDOUJaLEtBQUtmLEtBQUtHLGVBQ2YsQ0FFRjBCLFVBQUFBLENBQVd4RCxHQUNQLE9BQU95QyxNQUFNLEdBQUdkLEtBQUtDLGtCQUFrQjVCLElBQU0sQ0FDM0M4QyxPQUFRLFNBQ1JwQixRQUFTQyxLQUFLRSxXQUNiYSxLQUFNWCxJQUNQLEdBQUlBLEVBQUlDLEdBQ04sT0FBT0QsRUFBSUUsT0FFZkMsUUFBUUMsT0FBTyxVQUFVSixFQUFJSyxXQUVqQyxDQUVBcUIsVUFBQUEsQ0FBV3pELEVBQUkwRCxHQUNYLE9BQU9qQixNQUFNLEdBQUdkLEtBQUtDLGtCQUFrQjVCLFVBQVksQ0FDakQ4QyxPQUFRWSxFQUFVLFNBQVcsTUFDN0JoQyxRQUFTQyxLQUFLRSxXQUNiYSxLQUFNWCxJQUNQLEdBQUlBLEVBQUlDLEdBQ04sT0FBT0QsRUFBSUUsT0FFZkMsUUFBUUMsT0FBTyxVQUFVSixFQUFJSyxXQUVqQyxHRHpFb0IsQ0FDbEJYLFFBQVMsa0RBQ1RDLFFBQVMsQ0FDUGlDLGNBQWUsdUNBQ2YsZUFBZ0Isc0JBT2RDLEVBQW9CQyxTQUFTOUQsY0FBYyxzQkFDM0MrRCxFQUFtQkQsU0FBUzlELGNBQWMscUJBQzFDZ0UsRUFBY0YsU0FBUzlELGNBQWMsa0JBQ3JDaUUsRUFBcUJILFNBQVM5RCxjQUFjLHlCQUM1Q2tFLEVBQWNKLFNBQVM5RCxjQUFjLG9CQUNyQ21FLEVBQW1CTCxTQUFTOUQsY0FBYyx3QkFHMUNvRSxFQUFZTixTQUFTOUQsY0FBYyxlQUNuQ3FFLEVBQVlQLFNBQVM5RCxjQUFjLG1CQUNuQ3NFLEVBQWNSLFNBQVM5RCxjQUFjLGlCQUNyQ3VFLEVBQWVULFNBQVM5RCxjQUFjLGtCQUN0Q3dFLEVBQWNWLFNBQVM5RCxjQUFjLGlCQUdyQ3lFLEVBQWtCTCxFQUFVcEUsY0FBYyxnQkFDMUMwRSxFQUFXTCxFQUFVckUsY0FBYyxnQkFDbkMyRSxFQUFhTCxFQUFZdEUsY0FBYyxxQkFDdkM0RSxFQUFhSixFQUFZeEUsY0FBYyxnQkFHdkM2RSxFQUFxQlQsRUFBVXBFLGNBQWMsdUJBQzdDOEUsRUFBNEJWLEVBQVVwRSxjQUMxQyw4QkFFSStFLEVBQWdCVixFQUFVckUsY0FBYyx3QkFDeENnRixFQUFnQlgsRUFBVXJFLGNBQWMsd0JBQ3hDaUYsRUFBa0JYLEVBQVl0RSxjQUFjLHlCQUc1Q2tGLEVBQW9CZCxFQUFVcEUsY0FBYyxxQkFDNUNtRixFQUFvQmQsRUFBVXJFLGNBQWMscUJBQzVDb0YsRUFBc0JkLEVBQVl0RSxjQUFjLHFCQUNoRHFGLEVBQXVCZCxFQUFhdkUsY0FBYyxxQkFDbERzRixFQUFzQmQsRUFBWXhFLGNBQWMscUJBSWhEdUYsR0FEa0JYLEVBQVc1RSxjQUFjLHlCQUN6QjRFLEVBQVc1RSxjQUFjLDBCQUczQ3dGLEVBQXNCakIsRUFBYXZFLGNBQWMsaUJBQ2pEeUYsRUFBd0JsQixFQUFhdkUsY0FBYyxtQkFHbkQwRixFQUFlNUIsU0FBUzlELGNBQWMsa0JBQ3RDMkYsRUFBWTdCLFNBQVM5RCxjQUFjLGdCQUd6QyxJQUFJNEYsRUFBc0IsS0FDdEJDLEVBQWlCLEtBR3JCLFNBQVNDLEVBQVVDLEdBQ2pCQSxFQUFNN0YsVUFBVUssSUFBSSxnQkFDcEJ1RCxTQUFTa0MsaUJBQWlCLFVBQVdDLEVBQ3ZDLENBRUEsU0FBU0MsRUFBV0gsR0FDbEJBLEVBQU03RixVQUFVQyxPQUFPLGdCQUN2QjJELFNBQVNxQyxvQkFBb0IsVUFBV0YsRUFDMUMsQ0FFQSxTQUFTQSxFQUFlRyxHQUN0QixHQUFnQixXQUFaQSxFQUFJQyxJQUFrQixDQUN4QixNQUFNUCxFQUFZaEMsU0FBUzlELGNBQWMsaUJBQ3JDOEYsR0FBV0ksRUFBV0osRUFDNUIsQ0FDRixDQVdBLFNBQVNRLEVBQWVDLEdBQ3RCLE1BQU1DLEVBQWNkLEVBQWFlLFFBQzlCekcsY0FBYyxTQUNkMEcsV0FBVSxHQUNQQyxFQUFjSCxFQUFZeEcsY0FBYyxnQkFDeEM0RyxFQUFhSixFQUFZeEcsY0FBYyxnQkFDdkM2RyxFQUFVTCxFQUFZeEcsY0FBYyxtQkFDcEM4RyxFQUFZTixFQUFZeEcsY0FBYyxxQkEwQzVDLE9BdkNBMkcsRUFBWUksSUFBTVIsRUFBS3pELEtBQ3ZCNkQsRUFBWUssSUFBTVQsRUFBSzFELEtBQ3ZCK0QsRUFBV3hHLFlBQWNtRyxFQUFLMUQsS0FHMUIwRCxFQUFLNUMsU0FFTGtELEVBQVEzRyxVQUFVSyxJQUFJLHdCQUkxQnNHLEVBQVFiLGlCQUFpQixRQUFTLEtBQ2hDLE1BQU1yQyxFQUFVa0QsRUFBUTNHLFVBQVUrRyxTQUFTLHdCQUUzQ3pGLEVBQ0drQyxXQUFXNkMsRUFBS1csSUFBS3ZELEdBQ3JCaEIsS0FBSyxLQUNKa0UsRUFBUTNHLFVBQVVpSCxPQUFPLDBCQUUxQkMsTUFBT0MsSUFDTkMsUUFBUUMsTUFBTSx5QkFBMEJGLE9BSzlDVixFQUFZWCxpQkFBaUIsUUFBUyxLQUNwQ1IsRUFBb0J1QixJQUFNUixFQUFLekQsS0FDL0IwQyxFQUFvQndCLElBQU1ULEVBQUsxRCxLQUMvQjRDLEVBQXNCckYsWUFBY21HLEVBQUsxRCxLQUN6Q2lELEVBQVV2QixLQUladUMsRUFBVWQsaUJBQWlCLFFBQVMsS0FDbENKLEVBQXNCWSxFQUN0QlgsRUFBaUJVLEVBQUtXLElBQ3RCcEIsRUFBVXRCLEtBR0xnQyxDQUNULENBM0RBMUMsU0FBUzBELGlCQUFpQixVQUFVM0gsUUFBU2tHLElBQzNDQSxFQUFNQyxpQkFBaUIsWUFBY0ksSUFDL0JBLEVBQUlxQixTQUFXMUIsR0FDakJHLEVBQVdILE9BNERqQixJQUFJMkIsRUFBZ0IsS0ZwRGM5SCxNRXNEbEM0QixFQUNHYyxhQUNBSyxLQUFLLEVBQUVnRixFQUFPQyxNQUNiRixFQUFnQkUsRUFBU1YsSUFDekJoRCxFQUFZNkMsSUFBTWEsRUFBU3BFLE9BQzNCVSxFQUFZOEMsSUFBTVksRUFBUy9FLEtBQzNCbUIsRUFBWTVELFlBQWN3SCxFQUFTL0UsS0FDbkNvQixFQUFtQjdELFlBQWN3SCxFQUFTdkUsTUFFMUNzRSxFQUFNOUgsUUFBU2dJLElBQ2IsTUFBTXJCLEVBQWNGLEVBQWV1QixHQUNuQ2xDLEVBQVVtQyxPQUFPdEIsT0FHcEJZLE1BQU1FLFFBQVFDLE9BS2pCMUQsRUFBa0JtQyxpQkFBaUIsUUFBUyxLQUMxQ25CLEVBQW1Ca0QsTUFBUS9ELEVBQVk1RCxZQUN2QzBFLEVBQTBCaUQsTUFBUTlELEVBQW1CN0QsWUFDckRYLEVBQ0UyRSxFQUNBLENBQUNTLEVBQW9CQyxHQUNyQjVGLEdBRUY0RyxFQUFVMUIsS0FHWkssRUFBZ0J1QixpQkFBaUIsU0FBV0ksSUFDMUNBLEVBQUk0QixpQkFHSixNQUFNQyxFQUFZN0IsRUFBSThCLFVBRXRCakgsRUFBY2dILEdBQVcsR0FHekJ6RyxFQUNHNEIsYUFBYSxDQUNaUCxLQUFNZ0MsRUFBbUJrRCxNQUN6QjFFLE1BQU95QixFQUEwQmlELFFBRWxDcEYsS0FBTTRELElBQ0x2QyxFQUFZNUQsWUFBY21HLEVBQUsxRCxLQUMvQm9CLEVBQW1CN0QsWUFBY21HLEVBQUtsRCxNQUN0QzZDLEVBQVc5QixLQUVaZ0QsTUFBTUUsUUFBUUMsT0FDZFksUUFBUSxLQUdQbEgsRUFBY2dILEdBQVcsRUFBTyxZQUt0Q2xFLEVBQWlCaUMsaUJBQWlCLFFBQVMsS0FDekN2RyxFQUFnQjRFLEVBQVcsQ0FBQ1UsRUFBZUMsR0FBZ0I5RixHQUMzRHdGLEVBQVMwRCxRQUNUdEMsRUFBVXpCLEtBR1pLLEVBQVNzQixpQkFBaUIsU0FBV0ksSUFDbkNBLEVBQUk0QixpQkFFSixNQUFNQyxFQUFZN0IsRUFBSThCLFVBQ3RCakgsRUFBY2dILEdBQVcsR0FFekJ6RyxFQUNHb0IsUUFBUSxDQUNQQyxLQUFNa0MsRUFBY2dELE1BQ3BCakYsS0FBTWtDLEVBQWMrQyxRQUVyQnBGLEtBQU00RCxJQUNMLE1BQU04QixFQUFVL0IsRUFBZUMsR0FDL0JaLEVBQVUyQyxRQUFRRCxHQUNsQjNELEVBQVMwRCxRQUNUbEMsRUFBVzdCLEtBRVorQyxNQUFNRSxRQUFRQyxPQUNkWSxRQUFRLEtBQ1BsSCxFQUFjZ0gsR0FBVyxFQUFPLFlBS3RDOUQsRUFBaUI2QixpQkFBaUIsUUFBUyxLQUN6Q3ZHLEVBQWdCNkUsRUFBYSxDQUFDVyxHQUFrQi9GLEdBQ2hEeUYsRUFBV3lELFFBQ1h0QyxFQUFVeEIsS0FHWkssRUFBV3FCLGlCQUFpQixTQUFXSSxJQUNyQ0EsRUFBSTRCLGlCQUVKLE1BQU1DLEVBQVk3QixFQUFJOEIsVUFDdEJqSCxFQUFjZ0gsR0FBVyxHQUV6QnpHLEVBQ0c4QixhQUFhMkIsRUFBZ0I4QyxPQUM3QnBGLEtBQU00RCxJQUNMckMsRUFBWTZDLElBQU1SLEVBQUsvQyxPQUN2QjBDLEVBQVc1QixHQUNYSyxFQUFXeUQsVUFFWmhCLE1BQU1FLFFBQVFDLE9BQ2RZLFFBQVEsS0FDUGxILEVBQWNnSCxHQUFXLEVBQU8sWUFLdEM1QyxFQUFxQlcsaUJBQWlCLFFBQVMsSUFBTUUsRUFBVzNCLElBR2hFSyxFQUFXb0IsaUJBQWlCLFNBQVdJLElBQ3JDQSxFQUFJNEIsaUJBRUgsTUFBTUMsRUFBWTdCLEVBQUk4QixVQUN2QmpILEVBQWNnSCxHQUFXLEVBQU0sTUFBTyxlQUVqQ3BDLEdBQW1CRCxHQUV4QnBFLEVBQ0dpQyxXQUFXb0MsR0FDWGxELEtBQUssS0FDSmlELEVBQW9CekYsU0FDcEIrRixFQUFXMUIsR0FDWHFCLEVBQWlCLEtBQ2pCRCxFQUFzQixPQUV2QndCLE1BQU1FLFFBQVFDLE9BQ2RZLFFBQVEsS0FDUGxILEVBQWNnSCxHQUFXLEVBQU8sV0FJdEMxQyxFQUFnQlMsaUJBQWlCLFFBQVMsS0FDeENFLEVBQVcxQixHQUNYb0IsRUFBc0IsS0FDdEJDLEVBQWlCLE9BR25CUCxFQUFvQlUsaUJBQWlCLFFBQVMsS0FDNUNFLEVBQVcxQixHQUNYb0IsRUFBc0IsS0FDdEJDLEVBQWlCLE9BSW5CWCxFQUFrQmMsaUJBQWlCLFFBQVMsSUFBTUUsRUFBVzlCLElBQzdEZSxFQUFrQmEsaUJBQWlCLFFBQVMsSUFBTUUsRUFBVzdCLElBQzdEZSxFQUFvQlksaUJBQWlCLFFBQVMsSUFBTUUsRUFBVzVCLElGaE43QjFFLEVFbU5qQlYsRUZsTkdxSixNQUFNQyxLQUFLMUUsU0FBUzBELGlCQUFpQjVILEVBQU9ULGVBQ3JEVSxRQUFTNEksSUF2Qk1DLEVBQUNELEVBQWE3SSxLQUN0QyxNQUFNYSxFQUFZOEgsTUFBTUMsS0FBS0MsRUFBWWpCLGlCQUFpQjVILEVBQU9SLGdCQUMzRHNCLEVBQWdCK0gsRUFBWXpJLGNBQWNKLEVBQU9QLHNCQUVsRHFCLElBS0xGLEVBQWtCQyxFQUFXQyxFQUFlZCxHQUU1Q2EsRUFBVVosUUFBUzhJLElBQ2pCQSxFQUFhM0MsaUJBQWlCLFFBQVMsS0FqRGhCNEMsRUFBQ0gsRUFBYUUsRUFBYy9JLEtBQ2hEK0ksRUFBYS9ILFNBQVNDLE1BVE5nSSxFQUFDSixFQUFhRSxFQUFjL0ksS0FDakQsTUFBTWtKLEVBQWtCTCxFQUFZekksY0FBYyxJQUFJMkksRUFBYTFJLFlBQ25FNkksRUFBZ0IxSSxZQUFjLEdBQzlCdUksRUFBYXpJLFVBQVVDLE9BQU9QLEVBQU9MLGlCQUNyQ3VKLEVBQWdCNUksVUFBVUMsT0FBT1AsRUFBT0osYUFRdENxSixDQUFlSixFQUFhRSxFQUFjL0ksR0FuQnZCbUosRUFBQ04sRUFBYUUsRUFBY0ssRUFBVXBKLEtBQzNELE1BQU1rSixFQUFrQkwsRUFBWXpJLGNBQWMsSUFBSTJJLEVBQWExSSxZQUNuRTZJLEVBQWdCMUksWUFBYzRJLEVBQzlCTCxFQUFhekksVUFBVUssSUFBSVgsRUFBT0wsaUJBQ2xDdUosRUFBZ0I1SSxVQUFVSyxJQUFJWCxFQUFPSixhQWFuQ3VKLENBQWVOLEVBQWFFLEVBQWNBLEVBQWFNLGtCQUFtQnJKLElBZ0R4RWdKLENBQW1CSCxFQUFhRSxFQUFjL0ksR0FDOUNZLEVBQWtCQyxFQUFXQyxFQUFlZCxTQVU5QzhJLENBQWtCRCxFQUFhN0ksSSIsInNvdXJjZXMiOlsid2VicGFjazovL1Nwb3RzLy4vc3JjL3NjcmlwdHMvdmFsaWRhdGlvbi5qcyIsIndlYnBhY2s6Ly9TcG90cy8uL3NyYy91dGlscy9oZWxwZXJzLmpzIiwid2VicGFjazovL1Nwb3RzLy4vc3JjL3BhZ2VzL2luZGV4LmpzIiwid2VicGFjazovL1Nwb3RzLy4vc3JjL3V0aWxzL0FwaS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyA9PT0gQ29uZmlndXJhdGlvbiA9PT1cclxuZXhwb3J0IGNvbnN0IHZhbGlkYXRpb25Db25maWcgPSB7XHJcbiAgZm9ybVNlbGVjdG9yOiBcIi5tb2RhbF9fZm9ybVwiLFxyXG4gIGlucHV0U2VsZWN0b3I6IFwiLm1vZGFsX19pbnB1dFwiLFxyXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5tb2RhbF9fc3VibWl0LWJ0blwiLFxyXG4gIGluYWN0aXZlQnV0dG9uQ2xhc3M6IFwibW9kYWxfX3N1Ym1pdC1idG5fZGlzYWJsZWRcIixcclxuICBpbnB1dEVycm9yQ2xhc3M6IFwibW9kYWxfX2lucHV0X3R5cGVfZXJyb3JcIixcclxuICBlcnJvckNsYXNzOiBcIm1vZGFsX19lcnJvcl92aXNpYmxlXCIsIC8vIHVwZGF0ZSB0aGlzIGluIHlvdXIgQ1NTXHJcbn07XHJcblxyXG4vLyA9PT0gUmVzZXQgVmFsaWRhdGlvbiA9PT1cclxuZXhwb3J0IGZ1bmN0aW9uIHJlc2V0VmFsaWRhdGlvbihtb2RhbEVsZW1lbnQsIGlucHV0RWxlbWVudHMsIGNvbmZpZykge1xyXG4gIGlucHV0RWxlbWVudHMuZm9yRWFjaCgoaW5wdXQpID0+IHtcclxuICAgIGNvbnN0IGVycm9yRWxlbWVudCA9IG1vZGFsRWxlbWVudC5xdWVyeVNlbGVjdG9yKGAjJHtpbnB1dC5pZH0tZXJyb3JgKTtcclxuICAgIGlmIChlcnJvckVsZW1lbnQpIHtcclxuICAgICAgaW5wdXQuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuaW5wdXRFcnJvckNsYXNzKTtcclxuICAgICAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gXCJcIjtcclxuICAgICAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoY29uZmlnLmVycm9yQ2xhc3MpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG5cclxuICBjb25zdCBzdWJtaXRCdXR0b24gPSBtb2RhbEVsZW1lbnQucXVlcnlTZWxlY3Rvcihjb25maWcuc3VibWl0QnV0dG9uU2VsZWN0b3IpO1xyXG4gIGlmIChzdWJtaXRCdXR0b24pIHtcclxuICAgIHN1Ym1pdEJ1dHRvbi5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICBzdWJtaXRCdXR0b24uY2xhc3NMaXN0LmFkZChjb25maWcuaW5hY3RpdmVCdXR0b25DbGFzcyk7XHJcbiAgfVxyXG59XHJcblxyXG4vLyA9PT0gSW5wdXQgRXJyb3IgSGFuZGxpbmcgPT09XHJcbmNvbnN0IHNob3dJbnB1dEVycm9yID0gKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIGVycm9yTXNnLCBjb25maWcpID0+IHtcclxuICBjb25zdCBlcnJvck1zZ0VsZW1lbnQgPSBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKGAjJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYCk7XHJcbiAgZXJyb3JNc2dFbGVtZW50LnRleHRDb250ZW50ID0gZXJyb3JNc2c7XHJcbiAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5hZGQoY29uZmlnLmlucHV0RXJyb3JDbGFzcyk7XHJcbiAgZXJyb3JNc2dFbGVtZW50LmNsYXNzTGlzdC5hZGQoY29uZmlnLmVycm9yQ2xhc3MpO1xyXG59O1xyXG5cclxuY29uc3QgaGlkZUlucHV0RXJyb3IgPSAoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgY29uZmlnKSA9PiB7XHJcbiAgY29uc3QgZXJyb3JNc2dFbGVtZW50ID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihgIyR7aW5wdXRFbGVtZW50LmlkfS1lcnJvcmApO1xyXG4gIGVycm9yTXNnRWxlbWVudC50ZXh0Q29udGVudCA9IFwiXCI7XHJcbiAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoY29uZmlnLmlucHV0RXJyb3JDbGFzcyk7XHJcbiAgZXJyb3JNc2dFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoY29uZmlnLmVycm9yQ2xhc3MpO1xyXG59O1xyXG5cclxuLy8gPT09IElucHV0IFZhbGlkaXR5IENoZWNrID09PVxyXG5jb25zdCBjaGVja0lucHV0VmFsaWRpdHkgPSAoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgY29uZmlnKSA9PiB7XHJcbiAgaWYgKCFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQpIHtcclxuICAgIHNob3dJbnB1dEVycm9yKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIGlucHV0RWxlbWVudC52YWxpZGF0aW9uTWVzc2FnZSwgY29uZmlnKTtcclxuICB9IGVsc2Uge1xyXG4gICAgaGlkZUlucHV0RXJyb3IoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgY29uZmlnKTtcclxuICB9XHJcbn07XHJcblxyXG4vLyA9PT0gQnV0dG9uIFN0YXRlIEhhbmRsaW5nID09PVxyXG5cclxuLy8gQ2hlY2sgaWYgYW55IGlucHV0IGlzIGludmFsaWRcclxuY29uc3QgaGFzSW52YWxpZElucHV0ID0gKGlucHV0TGlzdCkgPT4ge1xyXG4gIHJldHVybiBpbnB1dExpc3Quc29tZSgoaW5wdXQpID0+ICFpbnB1dC52YWxpZGl0eS52YWxpZCk7XHJcbn07XHJcblxyXG4vLyBFbmFibGUgdGhlIGJ1dHRvblxyXG5jb25zdCBlbmFibGVCdXR0b24gPSAoYnV0dG9uRWxlbWVudCwgY29uZmlnKSA9PiB7XHJcbiAgYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IGZhbHNlO1xyXG4gIGJ1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuaW5hY3RpdmVCdXR0b25DbGFzcyk7XHJcbn07XHJcblxyXG4vLyBEaXNhYmxlIHRoZSBidXR0b25cclxuY29uc3QgZGlzYWJsZUJ1dHRvbiA9IChidXR0b25FbGVtZW50LCBjb25maWcpID0+IHtcclxuICBidXR0b25FbGVtZW50LmRpc2FibGVkID0gdHJ1ZTtcclxuICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5hZGQoY29uZmlnLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xyXG59O1xyXG5cclxuLy8gVG9nZ2xlIGJ1dHRvbiBzdGF0ZSBiYXNlZCBvbiBpbnB1dCB2YWxpZGl0eVxyXG5jb25zdCB0b2dnbGVCdXR0b25TdGF0ZSA9IChpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQsIGNvbmZpZykgPT4ge1xyXG4gIGlmIChoYXNJbnZhbGlkSW5wdXQoaW5wdXRMaXN0KSkge1xyXG4gICAgZGlzYWJsZUJ1dHRvbihidXR0b25FbGVtZW50LCBjb25maWcpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBlbmFibGVCdXR0b24oYnV0dG9uRWxlbWVudCwgY29uZmlnKTtcclxuICB9XHJcbn07XHJcblxyXG4gICAvLz09PSBTZXQgRXZlbnQgTGlzdGVuZXJzID09PVxyXG5jb25zdCBzZXRFdmVudExpc3RlbmVycyA9IChmb3JtRWxlbWVudCwgY29uZmlnKSA9PiB7XHJcbiAgY29uc3QgaW5wdXRMaXN0ID0gQXJyYXkuZnJvbShmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZy5pbnB1dFNlbGVjdG9yKSk7XHJcbiAgY29uc3QgYnV0dG9uRWxlbWVudCA9IGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoY29uZmlnLnN1Ym1pdEJ1dHRvblNlbGVjdG9yKTtcclxuXHJcbiAgaWYgKCFidXR0b25FbGVtZW50KSB7XHJcbiAgICAvL2NvbnNvbGUud2FybihcIlN1Ym1pdCBidXR0b24gbm90IGZvdW5kIGZvciBmb3JtOlwiLCBmb3JtRWxlbWVudCk7XHJcbiAgICByZXR1cm47XHJcbiAgfVxyXG5cclxuICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQsIGNvbmZpZyk7XHJcblxyXG4gIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsZW1lbnQpID0+IHtcclxuICAgIGlucHV0RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKCkgPT4ge1xyXG4gICAgICBjaGVja0lucHV0VmFsaWRpdHkoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgY29uZmlnKTtcclxuICAgICAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50LCBjb25maWcpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn07XHJcblxyXG4gIFxyXG4vLyA9PT0gRW5hYmxlIFZhbGlkYXRpb24gb24gQWxsIEZvcm1zID09PVxyXG4gZXhwb3J0IGNvbnN0IGVuYWJsZVZhbGlkYXRpb24gPSAoY29uZmlnKSA9PiB7XHJcbiAgIGNvbnN0IGZvcm1MaXN0ID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZy5mb3JtU2VsZWN0b3IpKTtcclxuICBmb3JtTGlzdC5mb3JFYWNoKChmb3JtRWxlbWVudCkgPT4ge1xyXG4gICAgc2V0RXZlbnRMaXN0ZW5lcnMoZm9ybUVsZW1lbnQsIGNvbmZpZyk7XHJcbiAgfSk7XHJcbiB9O1xyXG5cclxuIiwiZXhwb3J0IGZ1bmN0aW9uIHNldEJ1dHRvblRleHQoYnRuLCBpc0xvYWRpbmcsIGRlZmF1bHRUZXh0ID0gXCJTYXZlXCIsIGxvYWRpbmdUZXh0ID0gXCJTYXZpbmcuLi5cIikge1xyXG4gICAgaWYgKCFidG4pIHJldHVybjtcclxuXHJcbiAgICBpZiAoaXNMb2FkaW5nKSB7XHJcbiAgICAgICAgIGlmICghYnRuLmRhdGFzZXQub3JpZ2luYWxUZXh0KSB7XHJcbiAgICAgIGJ0bi5kYXRhc2V0Lm9yaWdpbmFsVGV4dCA9IGJ0bi50ZXh0Q29udGVudDtcclxuICAgIH1cclxuICAgICAgICAvL3NldCB0aGUgbG9hZGluZyB0ZXh0XHJcbiAgICAgICAgYnRuLnRleHRDb250ZW50ID0gbG9hZGluZ1RleHQ7XHJcbiAgICBcclxuICAgIH0gZWxzZSB7IC8vc2V0IG5vdCBsb2FkaW5nIHRleHRcclxuICAgICAgICBidG4udGV4dENvbnRlbnQgPSBidG4uZGF0YXNldC5vcmlnaW5hbFRleHQgfHwgZGVmYXVsdFRleHQ7XHJcbiAgICBidG4uZGlzYWJsZWQgPSBmYWxzZTsgXHJcbiAgfVxyXG59XHJcbiAgICAgICBcclxuICAgIFxyXG4iLCJpbXBvcnQgXCIuL2luZGV4LmNzc1wiO1xyXG5pbXBvcnQge1xyXG4gIGVuYWJsZVZhbGlkYXRpb24sXHJcbiAgdmFsaWRhdGlvbkNvbmZpZyxcclxuICByZXNldFZhbGlkYXRpb24sXHJcbn0gZnJvbSBcIi4uL3NjcmlwdHMvdmFsaWRhdGlvbi5qc1wiO1xyXG5pbXBvcnQgeyBzZXRCdXR0b25UZXh0IH0gZnJvbSBcIi4uL3V0aWxzL2hlbHBlcnMuanNcIjtcclxuaW1wb3J0IEFwaSBmcm9tIFwiLi4vdXRpbHMvQXBpLmpzXCI7XHJcblxyXG4vLyBJbml0aWFsaXplIEFQSVxyXG5jb25zdCBhcGkgPSBuZXcgQXBpKHtcclxuICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLWFwaS5lbi50cmlwbGV0ZW4tc2VydmljZXMuY29tL3YxXCIsXHJcbiAgaGVhZGVyczoge1xyXG4gICAgYXV0aG9yaXphdGlvbjogXCJmMTRlMjFlYS04ZjA2LTQ2MTYtOTgzZS05MmM0Njg5YmI4NTlcIixcclxuICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxyXG4gIH0sXHJcbn0pO1xyXG5cclxuLy8gLS0tLS0tLS0tLSBET00gRUxFTUVOVFMgLS0tLS0tLS0tLSAvL1xyXG5cclxuLy8gUHJvZmlsZVxyXG5jb25zdCBwcm9maWxlRWRpdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZWRpdC1idG5cIik7XHJcbmNvbnN0IHByb2ZpbGVBZGRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2FkZC1idG5cIik7XHJcbmNvbnN0IHByb2ZpbGVOYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19uYW1lXCIpO1xyXG5jb25zdCBwcm9maWxlRGVzY3JpcHRpb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2Rlc2NyaXB0aW9uXCIpO1xyXG5jb25zdCBhdmF0YXJJbWFnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYXZhdGFyXCIpO1xyXG5jb25zdCBhdmF0YXJFZGl0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXItYnRuXCIpO1xyXG5cclxuLy8gTW9kYWxzXHJcbmNvbnN0IGVkaXRNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZWRpdC1tb2RhbFwiKTtcclxuY29uc3QgY2FyZE1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNhZGQtY2FyZC1tb2RhbFwiKTtcclxuY29uc3QgYXZhdGFyTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2F2YXRhci1tb2RhbFwiKTtcclxuY29uc3QgcHJldmlld01vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcmV2aWV3LW1vZGFsXCIpO1xyXG5jb25zdCBkZWxldGVNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZGVsZXRlLW1vZGFsXCIpO1xyXG5cclxuLy8gRm9ybXNcclxuY29uc3QgZWRpdEZvcm1FbGVtZW50ID0gZWRpdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XHJcbmNvbnN0IGNhcmRGb3JtID0gY2FyZE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XHJcbmNvbnN0IGF2YXRhckZvcm0gPSBhdmF0YXJNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI2VkaXQtYXZhdGFyLWZvcm1cIik7XHJcbmNvbnN0IGRlbGV0ZUZvcm0gPSBkZWxldGVNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI2RlbGV0ZS1mb3JtXCIpO1xyXG5cclxuLy8gRm9ybSBJbnB1dHNcclxuY29uc3QgZWRpdE1vZGFsTmFtZUlucHV0ID0gZWRpdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjcHJvZmlsZS1uYW1lLWlucHV0XCIpO1xyXG5jb25zdCBlZGl0TW9kYWxEZXNjcmlwdGlvbklucHV0ID0gZWRpdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXHJcbiAgXCIjcHJvZmlsZS1kZXNjcmlwdGlvbi1pbnB1dFwiXHJcbik7XHJcbmNvbnN0IGNhcmROYW1lSW5wdXQgPSBjYXJkTW9kYWwucXVlcnlTZWxlY3RvcihcIiNhZGQtY2FyZC1uYW1lLWlucHV0XCIpO1xyXG5jb25zdCBjYXJkTGlua0lucHV0ID0gY2FyZE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjYWRkLWNhcmQtbGluay1pbnB1dFwiKTtcclxuY29uc3QgYXZhdGFyTGlua0lucHV0ID0gYXZhdGFyTW9kYWwucXVlcnlTZWxlY3RvcihcIiNwcm9maWxlLWF2YXRhci1pbnB1dFwiKTtcclxuXHJcbi8vIENsb3NlIEJ1dHRvbnNcclxuY29uc3QgZWRpdE1vZGFsQ2xvc2VCdG4gPSBlZGl0TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2xvc2UtYnRuXCIpO1xyXG5jb25zdCBjYXJkTW9kYWxDbG9zZUJ0biA9IGNhcmRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jbG9zZS1idG5cIik7XHJcbmNvbnN0IGF2YXRhck1vZGFsQ2xvc2VCdG4gPSBhdmF0YXJNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jbG9zZS1idG5cIik7XHJcbmNvbnN0IHByZXZpZXdNb2RhbENsb3NlQnRuID0gcHJldmlld01vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Nsb3NlLWJ0blwiKTtcclxuY29uc3QgZGVsZXRlTW9kYWxDbG9zZUJ0biA9IGRlbGV0ZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Nsb3NlLWJ0blwiKTtcclxuXHJcbi8vIERlbGV0ZSBtb2RhbCBidXR0b25zXHJcbmNvbnN0IGRlbGV0ZVN1Ym1pdEJ0biA9IGRlbGV0ZUZvcm0ucXVlcnlTZWxlY3RvcignYnV0dG9uW3R5cGU9XCJzdWJtaXRcIl0nKTtcclxuY29uc3QgZGVsZXRlQ2FuY2VsQnRuID0gZGVsZXRlRm9ybS5xdWVyeVNlbGVjdG9yKCdidXR0b25bdHlwZT1cImJ1dHRvblwiXScpO1xyXG5cclxuLy8gUHJldmlldyBtb2RhbCBjb250ZW50XHJcbmNvbnN0IHByZXZpZXdNb2RhbEltYWdlRWwgPSBwcmV2aWV3TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9faW1hZ2VcIik7XHJcbmNvbnN0IHByZXZpZXdNb2RhbENhcHRpb25FbCA9IHByZXZpZXdNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jYXB0aW9uXCIpO1xyXG5cclxuLy8gQ2FyZCB0ZW1wbGF0ZVxyXG5jb25zdCBjYXJkVGVtcGxhdGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2NhcmQtdGVtcGxhdGVcIik7XHJcbmNvbnN0IGNhcmRzTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZHNfX2xpc3RcIik7XHJcblxyXG4vLyBUcmFjayBjYXJkIHRvIGRlbGV0ZVxyXG5sZXQgc2VsZWN0ZWRDYXJkRWxlbWVudCA9IG51bGw7XHJcbmxldCBzZWxlY3RlZENhcmRJZCA9IG51bGw7XHJcblxyXG4vLyAtLS0tLS0tLS0tIE1PREFMIFVUSUxTIC0tLS0tLS0tLS0gLy9cclxuZnVuY3Rpb24gb3Blbk1vZGFsKG1vZGFsKSB7XHJcbiAgbW9kYWwuY2xhc3NMaXN0LmFkZChcIm1vZGFsX29wZW5lZFwiKTtcclxuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBoYW5kbGVFc2NDbG9zZSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNsb3NlTW9kYWwobW9kYWwpIHtcclxuICBtb2RhbC5jbGFzc0xpc3QucmVtb3ZlKFwibW9kYWxfb3BlbmVkXCIpO1xyXG4gIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGhhbmRsZUVzY0Nsb3NlKTtcclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlRXNjQ2xvc2UoZXZ0KSB7XHJcbiAgaWYgKGV2dC5rZXkgPT09IFwiRXNjYXBlXCIpIHtcclxuICAgIGNvbnN0IG9wZW5Nb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfb3BlbmVkXCIpO1xyXG4gICAgaWYgKG9wZW5Nb2RhbCkgY2xvc2VNb2RhbChvcGVuTW9kYWwpO1xyXG4gIH1cclxufVxyXG5cclxuZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5tb2RhbFwiKS5mb3JFYWNoKChtb2RhbCkgPT4ge1xyXG4gIG1vZGFsLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgKGV2dCkgPT4ge1xyXG4gICAgaWYgKGV2dC50YXJnZXQgPT09IG1vZGFsKSB7XHJcbiAgICAgIGNsb3NlTW9kYWwobW9kYWwpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59KTtcclxuXHJcbi8vIC0tLS0tLS0tLS0gR0VORVJBVEUgQ0FSRC0tLS0tLS0tLS0gLy9cclxuZnVuY3Rpb24gZ2V0Q2FyZEVsZW1lbnQoZGF0YSkge1xyXG4gIGNvbnN0IGNhcmRFbGVtZW50ID0gY2FyZFRlbXBsYXRlLmNvbnRlbnRcclxuICAgIC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRcIilcclxuICAgIC5jbG9uZU5vZGUodHJ1ZSk7XHJcbiAgY29uc3QgY2FyZEltYWdlRWwgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2ltYWdlXCIpO1xyXG4gIGNvbnN0IGNhcmROYW1lRWwgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX3RpdGxlXCIpO1xyXG4gIGNvbnN0IGxpa2VCdG4gPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtYnRuXCIpO1xyXG4gIGNvbnN0IGRlbGV0ZUJ0biA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fZGVsZXRlLWJ0blwiKTtcclxuXHJcbiAgLy8gU2V0IGltYWdlIGFuZCB0aXRsZVxyXG4gIGNhcmRJbWFnZUVsLnNyYyA9IGRhdGEubGluaztcclxuICBjYXJkSW1hZ2VFbC5hbHQgPSBkYXRhLm5hbWU7XHJcbiAgY2FyZE5hbWVFbC50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcclxuXHJcbiAgLy8gTWFyayBsaWtlZCBidXR0b24gaWYgdXNlciBhbHJlYWR5IGxpa2VkIHRoZSBjYXJkXHJcbiAgaWYgKGRhdGEuaXNMaWtlZCkge1xyXG4gIFxyXG4gICAgICBsaWtlQnRuLmNsYXNzTGlzdC5hZGQoXCJjYXJkX19saWtlLWJ0bl9saWtlZFwiKTtcclxuICAgIH1cclxuXHJcbiAgLy8gTGlrZSB0b2dnbGVcclxuICBsaWtlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICBjb25zdCBpc0xpa2VkID0gbGlrZUJ0bi5jbGFzc0xpc3QuY29udGFpbnMoXCJjYXJkX19saWtlLWJ0bl9saWtlZFwiKTtcclxuXHJcbiAgICBhcGlcclxuICAgICAgLmxpa2VTdGF0dXMoZGF0YS5faWQsIGlzTGlrZWQpXHJcbiAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICBsaWtlQnRuLmNsYXNzTGlzdC50b2dnbGUoXCJjYXJkX19saWtlLWJ0bl9saWtlZFwiKTtcclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKChlcnIpID0+IHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIHRvZ2dsZSBsaWtlOlwiLCBlcnIpO1xyXG4gICAgICB9KTtcclxuICAgfSk7XHJcblxyXG4gIC8vIE9wZW4gaW1hZ2UgaW4gcHJldmlldyBtb2RhbFxyXG4gIGNhcmRJbWFnZUVsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICBwcmV2aWV3TW9kYWxJbWFnZUVsLnNyYyA9IGRhdGEubGluaztcclxuICAgIHByZXZpZXdNb2RhbEltYWdlRWwuYWx0ID0gZGF0YS5uYW1lO1xyXG4gICAgcHJldmlld01vZGFsQ2FwdGlvbkVsLnRleHRDb250ZW50ID0gZGF0YS5uYW1lO1xyXG4gICAgb3Blbk1vZGFsKHByZXZpZXdNb2RhbCk7XHJcbiAgfSk7XHJcblxyXG4gIC8vIERlbGV0ZSBidXR0b24gb3BlbnMgZGVsZXRlIG1vZGFsXHJcbiAgZGVsZXRlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICBzZWxlY3RlZENhcmRFbGVtZW50ID0gY2FyZEVsZW1lbnQ7XHJcbiAgICBzZWxlY3RlZENhcmRJZCA9IGRhdGEuX2lkO1xyXG4gICAgb3Blbk1vZGFsKGRlbGV0ZU1vZGFsKTtcclxuICB9KTtcclxuXHJcbiAgcmV0dXJuIGNhcmRFbGVtZW50O1xyXG59XHJcblxyXG4vLyAtLS0tLS0tLS0tIEFQSTogSU5JVElBTCBGRVRDSCAtLS0tLS0tLS0tIC8vXHJcblxyXG5sZXQgY3VycmVudFVzZXJJZCA9IG51bGw7XHJcblxyXG5hcGlcclxuICAuZ2V0QXBwSW5mbygpXHJcbiAgLnRoZW4oKFtjYXJkcywgdXNlckluZm9dKSA9PiB7XHJcbiAgICBjdXJyZW50VXNlcklkID0gdXNlckluZm8uX2lkO1xyXG4gICAgYXZhdGFySW1hZ2Uuc3JjID0gdXNlckluZm8uYXZhdGFyO1xyXG4gICAgYXZhdGFySW1hZ2UuYWx0ID0gdXNlckluZm8ubmFtZTtcclxuICAgIHByb2ZpbGVOYW1lLnRleHRDb250ZW50ID0gdXNlckluZm8ubmFtZTtcclxuICAgIHByb2ZpbGVEZXNjcmlwdGlvbi50ZXh0Q29udGVudCA9IHVzZXJJbmZvLmFib3V0O1xyXG5cclxuICAgIGNhcmRzLmZvckVhY2goKGNhcmREYXRhKSA9PiB7XHJcbiAgICAgIGNvbnN0IGNhcmRFbGVtZW50ID0gZ2V0Q2FyZEVsZW1lbnQoY2FyZERhdGEpO1xyXG4gICAgICBjYXJkc0xpc3QuYXBwZW5kKGNhcmRFbGVtZW50KTtcclxuICAgIH0pO1xyXG4gIH0pXHJcbiAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpO1xyXG5cclxuLy8gLS0tLS0tLS0tLSBNT0RBTCBFVkVOVCBMSVNURU5FUlMgLS0tLS0tLS0tLSAvL1xyXG5cclxuLy8gUHJvZmlsZSBlZGl0XHJcbnByb2ZpbGVFZGl0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgZWRpdE1vZGFsTmFtZUlucHV0LnZhbHVlID0gcHJvZmlsZU5hbWUudGV4dENvbnRlbnQ7XHJcbiAgZWRpdE1vZGFsRGVzY3JpcHRpb25JbnB1dC52YWx1ZSA9IHByb2ZpbGVEZXNjcmlwdGlvbi50ZXh0Q29udGVudDtcclxuICByZXNldFZhbGlkYXRpb24oXHJcbiAgICBlZGl0TW9kYWwsXHJcbiAgICBbZWRpdE1vZGFsTmFtZUlucHV0LCBlZGl0TW9kYWxEZXNjcmlwdGlvbklucHV0XSxcclxuICAgIHZhbGlkYXRpb25Db25maWdcclxuICApO1xyXG4gIG9wZW5Nb2RhbChlZGl0TW9kYWwpO1xyXG59KTtcclxuXHJcbmVkaXRGb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IHtcclxuICBldnQucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgLy8gVE9ETyAtIENoYW5nZSB0ZXh0IGNvbnRlbnQgdG8gXCJTYXZpbmcuLi5cIjtcclxuICBjb25zdCBzdWJtaXRCdG4gPSBldnQuc3VibWl0dGVyO1xyXG4gIC8vVE9ETyAtIHN1Ym1pdEJ0bi50ZXh0Q29udGVudCA9IFwiU2F2aW5nLi4uXCI7XHJcbiAgc2V0QnV0dG9uVGV4dChzdWJtaXRCdG4sIHRydWUpO1xyXG4gIFxyXG5cclxuICBhcGlcclxuICAgIC5lZGl0VXNlckluZm8oe1xyXG4gICAgICBuYW1lOiBlZGl0TW9kYWxOYW1lSW5wdXQudmFsdWUsXHJcbiAgICAgIGFib3V0OiBlZGl0TW9kYWxEZXNjcmlwdGlvbklucHV0LnZhbHVlLFxyXG4gICAgfSlcclxuICAgIC50aGVuKChkYXRhKSA9PiB7XHJcbiAgICAgIHByb2ZpbGVOYW1lLnRleHRDb250ZW50ID0gZGF0YS5uYW1lO1xyXG4gICAgICBwcm9maWxlRGVzY3JpcHRpb24udGV4dENvbnRlbnQgPSBkYXRhLmFib3V0O1xyXG4gICAgICBjbG9zZU1vZGFsKGVkaXRNb2RhbCk7XHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpXHJcbiAgICAuZmluYWxseSgoKSA9PiB7XHJcbiAgICAgLy8gVE9ETyAtIGNhbGwgc2V0QnV0dG9uVGV4dCBpbnN0ZWFkXHJcbiAgICAgLy9zdWJtaXRCdG4udGV4dENvbnRlbnQgPSBcIlNhdmVcIjtcclxuICAgICAgc2V0QnV0dG9uVGV4dChzdWJtaXRCdG4sIGZhbHNlLCBcIlNhdmVcIik7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbi8vIEFkZCBDYXJkIEZvcm1cclxucHJvZmlsZUFkZEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gIHJlc2V0VmFsaWRhdGlvbihjYXJkTW9kYWwsIFtjYXJkTmFtZUlucHV0LCBjYXJkTGlua0lucHV0XSwgdmFsaWRhdGlvbkNvbmZpZyk7XHJcbiAgY2FyZEZvcm0ucmVzZXQoKTtcclxuICBvcGVuTW9kYWwoY2FyZE1vZGFsKTtcclxufSk7XHJcblxyXG5jYXJkRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IHtcclxuICBldnQucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgY29uc3Qgc3VibWl0QnRuID0gZXZ0LnN1Ym1pdHRlcjtcclxuICBzZXRCdXR0b25UZXh0KHN1Ym1pdEJ0biwgdHJ1ZSk7XHJcblxyXG4gIGFwaVxyXG4gICAgLmFkZENhcmQoe1xyXG4gICAgICBuYW1lOiBjYXJkTmFtZUlucHV0LnZhbHVlLFxyXG4gICAgICBsaW5rOiBjYXJkTGlua0lucHV0LnZhbHVlLFxyXG4gICAgfSlcclxuICAgIC50aGVuKChkYXRhKSA9PiB7XHJcbiAgICAgIGNvbnN0IG5ld0NhcmQgPSBnZXRDYXJkRWxlbWVudChkYXRhKTtcclxuICAgICAgY2FyZHNMaXN0LnByZXBlbmQobmV3Q2FyZCk7XHJcbiAgICAgIGNhcmRGb3JtLnJlc2V0KCk7XHJcbiAgICAgIGNsb3NlTW9kYWwoY2FyZE1vZGFsKTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goY29uc29sZS5lcnJvcilcclxuICAgIC5maW5hbGx5KCgpID0+IHtcclxuICAgICAgc2V0QnV0dG9uVGV4dChzdWJtaXRCdG4sIGZhbHNlLCBcIlNhdmVcIik7XHJcbiAgICB9KTtcclxufSk7XHJcblxyXG4vLyBFZGl0IEF2YXRhclxyXG5hdmF0YXJFZGl0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgcmVzZXRWYWxpZGF0aW9uKGF2YXRhck1vZGFsLCBbYXZhdGFyTGlua0lucHV0XSwgdmFsaWRhdGlvbkNvbmZpZyk7XHJcbiAgYXZhdGFyRm9ybS5yZXNldCgpO1xyXG4gIG9wZW5Nb2RhbChhdmF0YXJNb2RhbCk7XHJcbn0pO1xyXG5cclxuYXZhdGFyRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IHtcclxuICBldnQucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgY29uc3Qgc3VibWl0QnRuID0gZXZ0LnN1Ym1pdHRlcjtcclxuICBzZXRCdXR0b25UZXh0KHN1Ym1pdEJ0biwgdHJ1ZSk7XHJcblxyXG4gIGFwaVxyXG4gICAgLnVwZGF0ZUF2YXRhcihhdmF0YXJMaW5rSW5wdXQudmFsdWUpXHJcbiAgICAudGhlbigoZGF0YSkgPT4ge1xyXG4gICAgICBhdmF0YXJJbWFnZS5zcmMgPSBkYXRhLmF2YXRhcjtcclxuICAgICAgY2xvc2VNb2RhbChhdmF0YXJNb2RhbCk7XHJcbiAgICAgIGF2YXRhckZvcm0ucmVzZXQoKTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goY29uc29sZS5lcnJvcilcclxuICAgIC5maW5hbGx5KCgpID0+IHtcclxuICAgICAgc2V0QnV0dG9uVGV4dChzdWJtaXRCdG4sIGZhbHNlLCBcIlNhdmVcIik7XHJcbiAgICB9KTtcclxufSk7XHJcblxyXG4vLyBQcmV2aWV3IG1vZGFsIGNsb3NlXHJcbnByZXZpZXdNb2RhbENsb3NlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiBjbG9zZU1vZGFsKHByZXZpZXdNb2RhbCkpO1xyXG5cclxuLy8gRGVsZXRlIG1vZGFsIGxvZ2ljXHJcbmRlbGV0ZUZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZ0KSA9PiB7XHJcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICBjb25zdCBzdWJtaXRCdG4gPSBldnQuc3VibWl0dGVyO1xyXG4gIHNldEJ1dHRvblRleHQoc3VibWl0QnRuLCB0cnVlLCBcIlllc1wiLCBcIkRlbGV0aW5nLi4uXCIpO1xyXG5cclxuICBpZiAoIXNlbGVjdGVkQ2FyZElkIHx8ICFzZWxlY3RlZENhcmRFbGVtZW50KSByZXR1cm47XHJcblxyXG4gIGFwaVxyXG4gICAgLmRlbGV0ZUNhcmQoc2VsZWN0ZWRDYXJkSWQpXHJcbiAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgIHNlbGVjdGVkQ2FyZEVsZW1lbnQucmVtb3ZlKCk7XHJcbiAgICAgIGNsb3NlTW9kYWwoZGVsZXRlTW9kYWwpO1xyXG4gICAgICBzZWxlY3RlZENhcmRJZCA9IG51bGw7XHJcbiAgICAgIHNlbGVjdGVkQ2FyZEVsZW1lbnQgPSBudWxsO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaChjb25zb2xlLmVycm9yKVxyXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICBzZXRCdXR0b25UZXh0KHN1Ym1pdEJ0biwgZmFsc2UsIFwiWWVzXCIpO1xyXG4gICAgfSk7XHJcbn0pO1xyXG5cclxuZGVsZXRlQ2FuY2VsQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgY2xvc2VNb2RhbChkZWxldGVNb2RhbCk7XHJcbiAgc2VsZWN0ZWRDYXJkRWxlbWVudCA9IG51bGw7XHJcbiAgc2VsZWN0ZWRDYXJkSWQgPSBudWxsO1xyXG59KTtcclxuXHJcbmRlbGV0ZU1vZGFsQ2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICBjbG9zZU1vZGFsKGRlbGV0ZU1vZGFsKTtcclxuICBzZWxlY3RlZENhcmRFbGVtZW50ID0gbnVsbDtcclxuICBzZWxlY3RlZENhcmRJZCA9IG51bGw7XHJcbn0pO1xyXG5cclxuLy8gQ2xvc2UgbW9kYWwgYnV0dG9uc1xyXG5lZGl0TW9kYWxDbG9zZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gY2xvc2VNb2RhbChlZGl0TW9kYWwpKTtcclxuY2FyZE1vZGFsQ2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IGNsb3NlTW9kYWwoY2FyZE1vZGFsKSk7XHJcbmF2YXRhck1vZGFsQ2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IGNsb3NlTW9kYWwoYXZhdGFyTW9kYWwpKTtcclxuXHJcbi8vIC0tLS0tLS0tLS0gVkFMSURBVElPTiAtLS0tLS0tLS0tIC8vXHJcbmVuYWJsZVZhbGlkYXRpb24odmFsaWRhdGlvbkNvbmZpZyk7XHJcbiIsImNsYXNzIEFwaSB7XHJcbiAgY29uc3RydWN0b3IoeyBiYXNlVXJsLCBoZWFkZXJzIH0pIHtcclxuICAgIHRoaXMuX2Jhc2VVcmwgPSBiYXNlVXJsO1xyXG4gICAgdGhpcy5faGVhZGVycyA9IGhlYWRlcnM7XHJcbiAgfVxyXG5cclxuICAvLyBVdGlsaXR5OiBDaGVjayByZXNwb25zZVxyXG4gIF9jaGVja1Jlc3BvbnNlKHJlcykge1xyXG4gICAgaWYgKHJlcy5vaykge1xyXG4gICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgIH1cclxuICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcclxuICB9XHJcblxyXG4gICAgLy8gR2V0IGJvdGggY2FyZHMgKyB1c2VyIGluZm8gYXQgb25jZVxyXG4gIGdldEFwcEluZm8oKSB7XHJcbiAgICAvL1RPRE8gLSBjYWxsIGdldFVzZXJJbmZvIGl0IGluIHRoaXMgYXJyYXlcclxuICAgIHJldHVybiBQcm9taXNlLmFsbChbdGhpcy5nZXRJbml0aWFsQ2FyZHMoKSwgdGhpcy5nZXRVc2VySW5mbygpXSk7XHJcbiAgfVxyXG5cclxuICAvLyBDYXJkc1xyXG4gIGdldEluaXRpYWxDYXJkcygpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XHJcbiAgfVxyXG5cclxuICAvLyBVc2VyIHByb2ZpbGUgaW5mb1xyXG4gIGdldFVzZXJJbmZvKCkge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcclxuICB9XHJcblxyXG4gIC8vIFRPRE8gLSBpbXBsZW1lbnQgUE9TVCAvIGNhcmRzXHJcbmFkZENhcmQoeyBuYW1lLCBsaW5rIH0pIHtcclxuICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XHJcbiAgICBtZXRob2Q6IFwiUE9TVFwiLFxyXG4gICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgbmFtZSwgbGluayB9KVxyXG4gIH0pLnRoZW4odGhpcy5faGFuZGxlUmVzcG9uc2UpO1xyXG59XHJcblxyXG4gIC8vIEVkaXQgcHJvZmlsZSAobmFtZSArIGFib3V0KVxyXG4gIGVkaXRVc2VySW5mbyh7IG5hbWUsIGFib3V0IH0pIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcclxuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgbmFtZSwgYWJvdXQgfSksXHJcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xyXG4gIH1cclxuXHJcbiAgLy8gVXBkYXRlIGF2YXRhciBpbWFnZVxyXG4gIHVwZGF0ZUF2YXRhcihhdmF0YXJVcmwpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZS9hdmF0YXJgLCB7XHJcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGF2YXRhcjogYXZhdGFyVXJsIH0pLFxyXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcclxuICB9XHJcblxyXG5kZWxldGVDYXJkKGlkKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtpZH1gLCB7XHJcbiAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICB9XHJcbiAgICBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcclxuICB9KTtcclxufVxyXG5cclxubGlrZVN0YXR1cyhpZCwgaXNMaWtlZCkge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzLyR7aWR9L2xpa2VzYCwge1xyXG4gICAgICBtZXRob2Q6IGlzTGlrZWQgPyBcIkRFTEVURVwiIDogXCJQVVRcIixcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICB9XHJcbiAgICBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcclxuICB9KTtcclxufVxyXG59XHJcbiBcclxuZXhwb3J0IGRlZmF1bHQgQXBpO1xyXG4iXSwibmFtZXMiOlsidmFsaWRhdGlvbkNvbmZpZyIsImZvcm1TZWxlY3RvciIsImlucHV0U2VsZWN0b3IiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJpbnB1dEVycm9yQ2xhc3MiLCJlcnJvckNsYXNzIiwicmVzZXRWYWxpZGF0aW9uIiwibW9kYWxFbGVtZW50IiwiaW5wdXRFbGVtZW50cyIsImNvbmZpZyIsImZvckVhY2giLCJpbnB1dCIsImVycm9yRWxlbWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJpZCIsImNsYXNzTGlzdCIsInJlbW92ZSIsInRleHRDb250ZW50Iiwic3VibWl0QnV0dG9uIiwiZGlzYWJsZWQiLCJhZGQiLCJ0b2dnbGVCdXR0b25TdGF0ZSIsImlucHV0TGlzdCIsImJ1dHRvbkVsZW1lbnQiLCJzb21lIiwidmFsaWRpdHkiLCJ2YWxpZCIsImhhc0ludmFsaWRJbnB1dCIsImRpc2FibGVCdXR0b24iLCJlbmFibGVCdXR0b24iLCJzZXRCdXR0b25UZXh0IiwiYnRuIiwiaXNMb2FkaW5nIiwiZGVmYXVsdFRleHQiLCJsb2FkaW5nVGV4dCIsImRhdGFzZXQiLCJvcmlnaW5hbFRleHQiLCJhcGkiLCJjb25zdHJ1Y3RvciIsImJhc2VVcmwiLCJoZWFkZXJzIiwidGhpcyIsIl9iYXNlVXJsIiwiX2hlYWRlcnMiLCJfY2hlY2tSZXNwb25zZSIsInJlcyIsIm9rIiwianNvbiIsIlByb21pc2UiLCJyZWplY3QiLCJzdGF0dXMiLCJnZXRBcHBJbmZvIiwiYWxsIiwiZ2V0SW5pdGlhbENhcmRzIiwiZ2V0VXNlckluZm8iLCJmZXRjaCIsInRoZW4iLCJhZGRDYXJkIiwibmFtZSIsImxpbmsiLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsIl9oYW5kbGVSZXNwb25zZSIsImVkaXRVc2VySW5mbyIsImFib3V0IiwidXBkYXRlQXZhdGFyIiwiYXZhdGFyVXJsIiwiYXZhdGFyIiwiZGVsZXRlQ2FyZCIsImxpa2VTdGF0dXMiLCJpc0xpa2VkIiwiYXV0aG9yaXphdGlvbiIsInByb2ZpbGVFZGl0QnV0dG9uIiwiZG9jdW1lbnQiLCJwcm9maWxlQWRkQnV0dG9uIiwicHJvZmlsZU5hbWUiLCJwcm9maWxlRGVzY3JpcHRpb24iLCJhdmF0YXJJbWFnZSIsImF2YXRhckVkaXRCdXR0b24iLCJlZGl0TW9kYWwiLCJjYXJkTW9kYWwiLCJhdmF0YXJNb2RhbCIsInByZXZpZXdNb2RhbCIsImRlbGV0ZU1vZGFsIiwiZWRpdEZvcm1FbGVtZW50IiwiY2FyZEZvcm0iLCJhdmF0YXJGb3JtIiwiZGVsZXRlRm9ybSIsImVkaXRNb2RhbE5hbWVJbnB1dCIsImVkaXRNb2RhbERlc2NyaXB0aW9uSW5wdXQiLCJjYXJkTmFtZUlucHV0IiwiY2FyZExpbmtJbnB1dCIsImF2YXRhckxpbmtJbnB1dCIsImVkaXRNb2RhbENsb3NlQnRuIiwiY2FyZE1vZGFsQ2xvc2VCdG4iLCJhdmF0YXJNb2RhbENsb3NlQnRuIiwicHJldmlld01vZGFsQ2xvc2VCdG4iLCJkZWxldGVNb2RhbENsb3NlQnRuIiwiZGVsZXRlQ2FuY2VsQnRuIiwicHJldmlld01vZGFsSW1hZ2VFbCIsInByZXZpZXdNb2RhbENhcHRpb25FbCIsImNhcmRUZW1wbGF0ZSIsImNhcmRzTGlzdCIsInNlbGVjdGVkQ2FyZEVsZW1lbnQiLCJzZWxlY3RlZENhcmRJZCIsIm9wZW5Nb2RhbCIsIm1vZGFsIiwiYWRkRXZlbnRMaXN0ZW5lciIsImhhbmRsZUVzY0Nsb3NlIiwiY2xvc2VNb2RhbCIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJldnQiLCJrZXkiLCJnZXRDYXJkRWxlbWVudCIsImRhdGEiLCJjYXJkRWxlbWVudCIsImNvbnRlbnQiLCJjbG9uZU5vZGUiLCJjYXJkSW1hZ2VFbCIsImNhcmROYW1lRWwiLCJsaWtlQnRuIiwiZGVsZXRlQnRuIiwic3JjIiwiYWx0IiwiY29udGFpbnMiLCJfaWQiLCJ0b2dnbGUiLCJjYXRjaCIsImVyciIsImNvbnNvbGUiLCJlcnJvciIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJ0YXJnZXQiLCJjdXJyZW50VXNlcklkIiwiY2FyZHMiLCJ1c2VySW5mbyIsImNhcmREYXRhIiwiYXBwZW5kIiwidmFsdWUiLCJwcmV2ZW50RGVmYXVsdCIsInN1Ym1pdEJ0biIsInN1Ym1pdHRlciIsImZpbmFsbHkiLCJyZXNldCIsIm5ld0NhcmQiLCJwcmVwZW5kIiwiQXJyYXkiLCJmcm9tIiwiZm9ybUVsZW1lbnQiLCJzZXRFdmVudExpc3RlbmVycyIsImlucHV0RWxlbWVudCIsImNoZWNrSW5wdXRWYWxpZGl0eSIsImhpZGVJbnB1dEVycm9yIiwiZXJyb3JNc2dFbGVtZW50Iiwic2hvd0lucHV0RXJyb3IiLCJlcnJvck1zZyIsInZhbGlkYXRpb25NZXNzYWdlIl0sInNvdXJjZVJvb3QiOiIifQ==